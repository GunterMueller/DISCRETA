/*
** Generated by X-Designer Educational version
** This code may not be used in any program
** offered for resale or commercial use.
*/

/*
** X-Designer-generated prelude.
** Do not edit lines before "End of X-Designer generated prelude"
** Lines beginning ** X-Designer Stub indicate a stub
** which will not be output on re-generation
*/

/*
**LIBS: -lXm -lXt -lX11
*/

#include <stdlib.h>
#include <X11/Xatom.h>
#include <X11/Intrinsic.h>
#include <X11/Shell.h>

#include <Xm/Xm.h>
#include <Xm/Form.h>
#include <Xm/PushB.h>
#include <Xm/ToggleB.h>

#include "discreta.h"


extern void XDmanage_link ( Widget, XtPointer client_data, XtPointer );
extern void XDunmanage_link ( Widget, XtPointer client_data, XtPointer );
extern void XDpopup_link ( Widget, XtPointer client_data, XtPointer );
extern void XDpopdown_link ( Widget, XtPointer client_data, XtPointer );
extern void XDmap_link ( Widget, XtPointer client_data, XtPointer );
extern void XDunmap_link ( Widget, XtPointer client_data, XtPointer );
extern void XDenable_link ( Widget, XtPointer client_data, XtPointer );
extern void XDdisable_link ( Widget, XtPointer client_data, XtPointer );

/* End of X-Designer generated prelude */




#include "disc.h"

DISCRETA_FORM_DATA *form_data = NULL;

Widget Discreta_scrolled_text = NULL;

void set_group_label(BYTE *s)
{
	text_field_set_string(Text_group, s);
}

void set_v(INT v)
{
	text_field_set_int(Text_v, v);
}

void set_group_order(BYTE *s)
{
	text_field_set_string(Text_order, s);
}

void text_field_set_string(Widget w, char *p)
{
	XmTextFieldSetString(w, p);
}

void text_field_set_int(Widget w, INT v)
{
	BYTE str[256];
	
	sprintf(str, "%ld", v);
	XmTextFieldSetString(w, str);
}

void text_field_get_string(Widget w, char *p, INT p_size)
{
	char *q;
	
	q = XmTextFieldGetString(w);
	if (q && strlen(q)) {
		strncpy(p, q, p_size);
		p[p_size - 1] = 0;
		}
	else
		*p = 0;
	if (q)
		XtFree(q);
}

INT text_field_get_int(Widget w)
{
	char *q;
	INT i;
	
	q = XmTextFieldGetString(w);
	if (q && strlen(q))
		sscanf(q, "%ld", &i);
	else
		i = 0;
	if (q)
		XtFree(q);
	return i;
}

INT get_toggle_state(Widget w)
{
	Arg al[64];
        int ac = 0; 
	char v;
	
	XtSetArg(al[ac], XmNset, &v); ac++;
	XtGetValues(w, al, ac);
	return (INT) v;
}

INT set_toggle_state(Widget w, INT v)
{
	Arg al[64];
        int ac = 0; 
	
	XtSetArg(al[ac], XmNset, v); ac++;
	XtSetValues(w, al, ac);
	return (INT) v;
}


void get_form_data(DISCRETA_FORM_DATA *p)
{

	// group dialog:
	text_field_get_string(Text_group, p->group_label, STRING_SIZE);
	p->v = text_field_get_int(Text_v);
	text_field_get_string(Text_order, p->group_order, STRING_SIZE);
	printf("group %s\n", p->group_label);
	printf("v = %ld\n", p->v);
	printf("group_order %s\n", p->group_order);
	
	// parameter dialog:
	p->lambda = text_field_get_int(Text_lambda);
	p->p = text_field_get_int(Text_p);
	printf("lambda = %ld\n", p->lambda);
	printf("p = %ld\n", p->p);

	// compute KM-matrices dialog:
	p->t = text_field_get_int(Text_t);
	p->k = text_field_get_int(Text_k);
	text_field_get_string(Text_file, p->KM_fname, STRING_SIZE);
	p->f_strong_generators = get_toggle_state(Toggle_strong_gens);
	p->f_orderly_generation = get_toggle_state(Toggle_orderly_generation);
	p->f_TDO = get_toggle_state(Toggle_TDO);
	p->f_extension_construction = FALSE; //get_toggle_state(Toggle_extension);
	p->f_canonical_representatives = get_toggle_state(Toggle_canonical_reps);
	p->f_k_k2_design = get_toggle_state(Toggle_k2);
	p->k2 = text_field_get_int(Text_k2);
	p->f_graphical_design = get_toggle_state(Toggle_graphical);
	p->f_graphical_design_Sn = get_toggle_state(Toggle_graph_sn);
	p->graphical_design_n = text_field_get_int(Text_graphical_n);
	p->graphical_nrow = text_field_get_int(LLL_graphical_nrow_t);
	p->graphical_ncol = text_field_get_int(LLL_graphical_ncol_t);
	
	if (get_toggle_state(To_asup))
		p->toggle_lines = 0;
	else if (get_toggle_state(To_ainf)) 
		p->toggle_lines = 1;
	else if (get_toggle_state(To_all)) 
		p->toggle_lines = 2;
	else if (get_toggle_state(To_poset)) 
		p->toggle_lines = 3;
	
	// linear group:
	p->linear_n = text_field_get_int(LIN_n_text);
	p->linear_q = text_field_get_int(LIN_q_text);
	// p->linear_toggle = 0;
	
	// well known group;
	p->well_n = text_field_get_int(OTHER_n_text);
	p->well_m = text_field_get_int(OTHER_m_text);
	// p->well_rb_state;
	
	// solvable_group:
	p->solvable_n = text_field_get_int(Solvable_n_text);
	p->solvable_m = text_field_get_int(Solvable_m_text);
	// p->solvable_toggle = 0;

	// sporadic group:
	// p->sporadic_toggle = 3;
	
	// LLL parameter:
	p->LLL_c0 = text_field_get_int(LLL_c0_factor_text);
	p->LLL_beta = text_field_get_int(LLL_beta_text);
	p->LLL_p = text_field_get_int(LLL_p_text);
	p->silence_level = text_field_get_int(Silence_t);
	p->nb_restart = text_field_get_int(Nb_restart_t);

	// largeset parameter:
	p->largeset_N = text_field_get_int(LS_N_text);
	p->largeset_max_rounds = text_field_get_int(LS_max_round_text);
	p->largeset_max_solutions = text_field_get_int(LS_max_solutions_text);
	p->largeset_max_loops = text_field_get_int(LS_max_loops_text);

	// report options:
	p->report_select_lambda = text_field_get_int(Pref_sel_lambda);
	p->report_select_first = text_field_get_int(Pref_sel_first);
	p->report_select_len = text_field_get_int(Pref_sel_len);


	// gsel dialog:
	text_field_get_string(Gsel_file_text, p->gsel_file, STRING_SIZE);
	text_field_get_string(Gsel_generator_text, p->gsel_generator, STRING_SIZE);
	p->i_th = text_field_get_int(Gsel_i_th_text);

	// database:
	p->t_min = text_field_get_int(Db_t_min_text);
	p->t_max = text_field_get_int(Db_t_max_text);
	p->v_min = text_field_get_int(Db_v_min_text);
	p->v_max = text_field_get_int(Db_v_max_text);
	p->k_min = text_field_get_int(Db_k_min_text);
	p->k_max = text_field_get_int(Db_k_max_text);
	p->lambda_min = text_field_get_int(Db_lambda_min_text);
	p->lambda_max = text_field_get_int(Db_lambda_max_text);
}

void alloc_form()
{
	// discreta_init();
	
	if (form_data == NULL) {
		form_data = (DISCRETA_FORM_DATA *) malloc(sizeof(DISCRETA_FORM_DATA));
		form_data->group_label[0] = 0;
		form_data->group_order[0] = 0;
		form_data->KM_fname[0] = 0;
		form_data->f_choosing_normalizer = FALSE;
		form_data->gsel_file[0] = 0;
		form_data->gsel_generator[0] = 0;
		// form_data->g_form = Gsel_form_outer;
		// form_data->g_box = Gsel_list;
		form_data->g_nb_items = 0;
		form_data->g_sel = (VECTOR_OP) callocobject("alloc_form");
		form_data->g_sel->m_il(MAX_ITEMS);
		form_data->well_rb_state = 1;
		form_data->solvable_toggle = 0;
		form_data->linear_toggle = 3;
		form_data->sporadic_toggle = 3;
		form_data->solid_toggle = 0;
		form_data->toggle_lines = 0;
		}
}

void dealloc_form()
{
	// discreta_exit();
}

INT decode_form()
{
	alloc_form();
	get_form_data(form_data);
	return TRUE;
}


void init_discreta_text()
{
	Arg args[64];
	INT i;
	
	i = 0;
	// XtSetArg(args[i], XmNeditMode, XmMULTI_LINE_EDIT); i++;
	XtSetArg(args[i], XmNvalue, discreta_copyright_text); i++;
	// XtSetArg(args[i], XmNfontList, km_font1); i++;
	XtSetValues(Discreta_scrolled_text, args, i);
}

void out_str(char *s)
{
	XmTextPosition tp;

	printf("%s\n", s);
	tp = XmTextGetLastPosition(Discreta_scrolled_text);
	XmTextInsert(Discreta_scrolled_text, tp, s);
}


void program_init()
{
	// Widget w;
	extern Widget xdref_11;
	

	// w = XtNameToWidget(reference, names);
	Discreta_scrolled_text = xdref_11;
	alloc_form();
	init_discreta_text();
	// set_toggle_state(Toggle_strong_gens, TRUE);
	// set_toggle_state(Toggle_orderly_generation, TRUE);
	set_toggle_state(Toggle_TDO, TRUE);
	// set_toggle_state(Toggle_extension, TRUE);
	set_toggle_state(Toggle_canonical_reps, TRUE);
	// set_toggle_state(Toggle_k2, TRUE);
	// set_toggle_state(Toggle_graphical, TRUE);
	// set_toggle_state(Toggle_graph_sn, TRUE);
	
	text_field_set_int(Text_t, 5);
	text_field_set_int(Text_k, 6);
	if (km_fname_available())
		read_km_fname(form_data->KM_fname);
	text_field_set_string(Text_file, form_data->KM_fname);
	
	text_field_set_int(Text_lambda, 1);
	text_field_set_int(Text_p, 1);
	
	text_field_set_int(LLL_c0_factor_text, 20);
	text_field_set_int(LLL_beta_text, 120);
	text_field_set_int(LLL_p_text, 14);
	text_field_set_int(Silence_t, 0);
	text_field_set_int(Nb_restart_t, 4);
	text_field_set_int(LS_max_round_text, 50);
	text_field_set_int(LS_N_text, 2);
	text_field_set_int(LS_max_solutions_text, 10);
	text_field_set_int(LS_max_loops_text, 2000000);
	
	text_field_set_int(LLL_graphical_nrow_t, 50);
	text_field_set_int(LLL_graphical_ncol_t, 9);
	
	text_field_set_int(Pref_sel_lambda, 1);
	text_field_set_int(Pref_sel_first, 1);
	text_field_set_int(Pref_sel_len, 1000000);
}










/*
 * here come the callback functions
 */


/*
 * main menu:
 */


/*
 * file menu:
 */


/*
** X-Designer Stub cb_quit
*/

void cb_quit(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	// XmPushButtonCallbackStruct *call_data = (XmPushButtonCallbackStruct *) xt_call_data ;
	// DISCRETA_FORM_DATA *p = form_data;
	
	// XtUnmanageChild(shell1);
	discreta_exit();
	exit(0);
}




/* 
 * group menu:
 */


/*
** X-Designer Stub cb_choose_aut_group
*/

void cb_choose_aut_group(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	// XmPushButtonCallbackStruct *call_data = (XmPushButtonCallbackStruct *) xt_call_data ;
	// DISCRETA_FORM_DATA *p = form_data;
	
	XtManageChild(Gsel_form_outer);
	alloc_form();
	form_data->f_choosing_normalizer = FALSE;
}

/*
** X-Designer Stub cb_show_solid
*/

void cb_show_solid(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	// XmPushButtonCallbackStruct *call_data = (XmPushButtonCallbackStruct *) xt_call_data ;
	BYTE buf[10000];
	BYTE cmd[10000];
	
	if (solid_fname_available()) {
		read_solid_fname(buf);
		printf("displaying solid %s\n", buf);
		sprintf(cmd, "view3d --balls %s &", buf);
		call_system(cmd);
		}
}


/*
** X-Designer Stub cb_choose_normalizer
*/

void cb_choose_normalizer(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	// XmPushButtonCallbackStruct *call_data = (XmPushButtonCallbackStruct *) xt_call_data ;
	// DISCRETA_FORM_DATA *p = form_data;
	
	XtManageChild(Gsel_form_outer);
	alloc_form();
	form_data->f_choosing_normalizer = TRUE;
}

/*
** X-Designer Stub cb_create_generators_db
*/

void cb_create_generators_db(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	// XmPushButtonCallbackStruct *call_data = (XmPushButtonCallbackStruct *) xt_call_data ;
	DISCRETA_FORM_DATA *p = form_data;
	
	get_form_data(p);
	do_db_generators_create_and_close(".");
}

/*
** X-Designer Stub cb_generators_db_add
*/

void cb_generators_db_add(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	// XmPushButtonCallbackStruct *call_data = (XmPushButtonCallbackStruct *) xt_call_data ;
	DISCRETA_FORM_DATA *p = form_data;
	VECTOR_OB gen;
	BYTE g_label[10000];
	BYTE g_label_tex[10000];
	DATABASE_OP D;
	
	get_form_data(p);
	get_group_from_selection(p->g_sel, p->g_nb_items, 
		&gen, g_label, g_label_tex);
	i_db_generators(&D, ".");
	db_generators_add(D, &gen, g_label, g_label_tex);
	e_db_generators(D);
	
}

/*
** X-Designer Stub cb_generators_db_dump_id
*/

void cb_generators_db_dump_id(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	// XmPushButtonCallbackStruct *call_data = (XmPushButtonCallbackStruct *) xt_call_data ;
	DISCRETA_FORM_DATA *p = form_data;
	
	get_form_data(p);
	do_db_generators_dump(".", 0);
}

/*
** X-Designer Stub cb_generators_db_dump_name
*/

void cb_generators_db_dump_name(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	// XmPushButtonCallbackStruct *call_data = (XmPushButtonCallbackStruct *) xt_call_data ;
	DISCRETA_FORM_DATA *p = form_data;
	
	get_form_data(p);
	do_db_generators_dump(".", 1);
}

/*
** X-Designer Stub cb_generators_db_dump_order
*/

void cb_generators_db_dump_order(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	// XmPushButtonCallbackStruct *call_data = (XmPushButtonCallbackStruct *) xt_call_data ;
	DISCRETA_FORM_DATA *p = form_data;
	
	get_form_data(p);
	do_db_generators_dump(".", 2);
}

/*
** X-Designer Stub cb_generators_db_dump_degree
*/

void cb_generators_db_dump_degree(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	// XmPushButtonCallbackStruct *call_data = (XmPushButtonCallbackStruct *) xt_call_data ;
	DISCRETA_FORM_DATA *p = form_data;
	
	get_form_data(p);
	do_db_generators_dump(".", 3);
}

/*
** X-Designer Stub cb_sgl
*/

void cb_sgl(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	// XmPushButtonCallbackStruct *call_data = (XmPushButtonCallbackStruct *) xt_call_data ;
	DISCRETA_FORM_DATA *p = form_data;
	VECTOR_OB gen, gen_pp, G, Inn_gen;
	SGL_OB L;
	BYTE g_label[10000];
	BYTE g_label_tex[10000];
	BYTE fname[10000];
	VECTOR_OB V;
	STRING_OB s;
	
	get_form_data(p);
		
	gen.m_il(0);
	printf("calling get_group_from_selection()\n");
	fflush(stdout);
	get_group_from_selection(p->g_sel, p->g_nb_items, 
		&gen, g_label, g_label_tex);
	printf("finished with get_group_from_selection()\n");
	fflush(stdout);

	
	vec_to_vec_pp(&gen, &gen_pp, 1 /* type */, NIL /* data */);
		
	calc_sgl(&gen_pp, &G, &Inn_gen, &L);
	printf("finished with calc_sgl()\n");
	fflush(stdout);
		
	V.m_il(6);
	gen_pp.swap((VECTOR_OP) V.s_i(0));
	G.swap((VECTOR_OP) V.s_i(1));
	Inn_gen.swap((VECTOR_OP) V.s_i(2));
	s.init(g_label);
	s.swap((STRING_OP) V.s_i(3));
	s.init(g_label_tex);
	s.swap((STRING_OP) V.s_i(4));
	L.swap((SGL_OP) V.s_i(5));
	
	sprintf(fname, "%s.sgl.dsc", g_label);
	V.save(fname);
}

/*
** X-Designer Stub cb_show_sgl3D
*/

void cb_show_sgl3D(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	// XmPushButtonCallbackStruct *call_data = (XmPushButtonCallbackStruct *) xt_call_data ;
	DISCRETA_FORM_DATA *p = form_data;
	BYTE cmd[10000];

	get_form_data(p);
	sprintf(cmd, "t116.out %s %ld", p->group_label, p->toggle_lines);
	call_system(cmd);

	printf("displaying subgroup lattice\n");
	sprintf(cmd, "view3d --balls %s_%ld.graph &", p->group_label, p->toggle_lines);
	call_system(cmd);
}

/*
** X-Designer Stub cb_show_sgl2D
*/

void cb_show_sgl2D(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	XmPushButtonCallbackStruct *call_data = (XmPushButtonCallbackStruct *) xt_call_data ;
	DISCRETA_FORM_DATA *p = form_data;
	BYTE cmd[10000];

	get_form_data(p);
	sprintf(cmd, "t116.out -2D %s %ld", p->group_label, p->toggle_lines);
	call_system(cmd);

	printf("displaying subgroup lattice\n");
	sprintf(cmd, "view3d --balls %s_%ld.graph &", p->group_label, p->toggle_lines);
	call_system(cmd);
}

/*
** X-Designer Stub cb_show_sgl
*/

void cb_show_sgl(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	// XmPushButtonCallbackStruct *call_data = (XmPushButtonCallbackStruct *) xt_call_data ;
	DISCRETA_FORM_DATA *p = form_data;
	BYTE fname[10000];
	VECTOR_OB V;
	VECTOR_OP gen, G, Inn_gen;
	SGL_OP L;
	STRING_OP g_label, g_label_tex;
	SG_LATTICE_LOCAL *sgll;
	BYTE cmd[10000];
	
	get_form_data(p);
	
	sprintf(fname, "%s.sgl.dsc", p->group_label);
	V.load(fname);
	if (V.s_li() < 6) 
		error("V too short");
	gen = (VECTOR_OP) V.s_i(0);
	G = (VECTOR_OP) V.s_i(1);
	Inn_gen = (VECTOR_OP) V.s_i(2);
	g_label = (STRING_OP) V.s_i(3);
	g_label_tex = (STRING_OP) V.s_i(4);
	L = (SGL_OP) V.s_i(5);
	printf("read a subgroup lattice of a group with ");
	printf("%ld generators\n", gen->s_li());
	printf("%ld elements\n", G->s_li());
	printf("%ld generators for Inn(G)\n", Inn_gen->s_li());
	printf("g_label = %s\n", g_label->s_str());
	printf("g_label_tex = %s\n", g_label_tex->s_str());
	
	sgll = open_sgll(L, 
		FALSE /* f_L_allocated */, 
		FALSE /* f_show_generators */, 
		FALSE /* f_with_perm */, 
		0 /* draw_lines_type */, 
		TRUE /* f_draw_sgl */, 
		TRUE /* f_burnside_tex */, 
		"" /* path_name */, 
		g_label->s_str(), 
		g_label_tex->s_str(), 
		TRUE /* f_verbose */);
		/* draw_lines_type: 0 = Asup, 1 = Ainf, 2 = all, 3 = poset */
	free_sgll(sgll);

	sprintf(cmd, "mpost %s.mp", g_label->s_str());
	printf("calling system: %s\n", cmd);
	fflush(stdout);
	call_system(cmd);
	
	sprintf(cmd, "latex %s.tex", g_label->s_str());
	printf("calling system: %s\n", cmd);
	fflush(stdout);
	call_system(cmd);
	
#if 0
	sprintf(cmd, "xdvi %s.dvi &", g_label->s_str());
	printf("calling system: %s\n", cmd);
	fflush(stdout);
	call_system(cmd);
#endif

	sprintf(cmd, "dvips %s.dvi -o", g_label->s_str());
	printf("calling system: %s\n", cmd);
	fflush(stdout);
	call_system(cmd);
	
	sprintf(cmd, "ghostview %s.ps", g_label->s_str());
	printf("calling system: %s\n", cmd);
	fflush(stdout);
	call_system(cmd);
	
}

/*
** X-Designer Stub cb_sgl_type
*/

void cb_sgl_type(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	// XmToggleButtonCallbackStruct *call_data = (XmToggleButtonCallbackStruct *) xt_call_data ;
	DISCRETA_FORM_DATA *p = form_data;
	Arg args[64];
	INT n, j = (INT) client_data;
	Widget w1, w2;
	
	w1 = widget_sgl_type(p->toggle_lines);
	n = 0;
	XtSetArg(args[n], XmNset, FALSE); n++;
	XtSetValues(w1, args, n);

	p->toggle_lines = j;
	w2 = widget_sgl_type(j);

	n = 0;
	XtSetArg(args[n], XmNset, TRUE); n++;
	XtSetValues(w2, args, n);
}

Widget widget_sgl_type(INT i)
{
	Widget w;
	
	switch (i) {
		case 0:
			w = To_asup;
			break;
		case 1:
			w = To_ainf;
			break;
		case 2:
			w = To_all;
			break;
		case 3:
			w = To_poset;
			break;
		default:
			printf("widget_sgl_type() unknown toggle state !\n");
			break;
		}
	return w;
}



/*
 * parameters menu
 */

/*
** X-Designer Stub cb_lambda_i
*/

void cb_lambda_i(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	// XmPushButtonCallbackStruct *call_data = (XmPushButtonCallbackStruct *) xt_call_data ;
	DISCRETA_FORM_DATA *p = form_data;
	
	get_form_data(p);
	calc_lambda_i(p->t, p->v, p->k, p->lambda);
}

/*
** X-Designer Stub cb_mendelsohn
*/

void cb_mendelsohn(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	// XmPushButtonCallbackStruct *call_data = (XmPushButtonCallbackStruct *) xt_call_data ;
	DISCRETA_FORM_DATA *p = form_data;
	
	get_form_data(p);
	do_mendelsohn(p->t, p->v, p->k, p->lambda);
}

/*
** X-Designer Stub cb_koehler
*/

void cb_koehler(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	// XmPushButtonCallbackStruct *call_data = (XmPushButtonCallbackStruct *) xt_call_data ;
	DISCRETA_FORM_DATA *p = form_data;
	
	get_form_data(p);
	do_koehler(p->t, p->v, p->k, p->lambda, p->p);
}





/*
 * Kramer-Mesner menu:
 */

/*
** X-Designer Stub cb_compute_KM
*/

void cb_compute_KM(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	// XmPushButtonCallbackStruct *call_data = (XmPushButtonCallbackStruct *) xt_call_data ;
	DISCRETA_FORM_DATA *p = form_data;
	
	get_form_data(p);
	if (p->f_graphical_design) {
		graphical_design(p->t, p->k, p->graphical_nrow, p->graphical_ncol);
		}
	else {
		VECTOR_OB gen;
		BYTE *g_label;
		BYTE *g_label_tex;
		
		g_label = (BYTE *) my_malloc(10000, "cb_compute_KM(), g_label");
		g_label_tex = (BYTE *) my_malloc(10000, "cb_compute_KM(), g_label_tex");
		*g_label = 0;
		*g_label_tex = 0;
		gen.m_il(0);
		printf("calling km_get_group_from_selection()\n");
		fflush(stdout);
		km_get_group_from_selection(p->g_sel, p->g_nb_items, 
			&gen, g_label, g_label_tex);
		printf("finished with km_get_group_from_selection(), calling compute_KM()...\n");
		fflush(stdout);
		
		compute_KM(&gen, g_label, g_label_tex, 
			p->t, p->k, 
			p->f_strong_generators, 
			p->f_orderly_generation, 
			p->f_TDO, 
			p->f_extension_construction, 
			p->f_canonical_representatives, 
			p->f_k_k2_design, 
			p->k2);
		my_free(g_label);
		my_free(g_label_tex);
		}
	read_km_fname(p->KM_fname);
}

/*
** X-Designer Stub cb_show_KM
*/

void cb_show_KM(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	// XmPushButtonCallbackStruct *call_data = (XmPushButtonCallbackStruct *) xt_call_data ;
	DISCRETA_FORM_DATA *p = form_data;
	
	get_form_data(p);
	show_KM_matrix(p->KM_fname);
}





/* 
 * solve menu:
 */


/*
** X-Designer Stub cb_LLL
*/

void cb_LLL(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	// XmPushButtonCallbackStruct *call_data = (XmPushButtonCallbackStruct *) xt_call_data ;
	DISCRETA_FORM_DATA *p = form_data;
	
	get_form_data(p);
	cb_do_LLL(p->silence_level /* f_silent */, p->KM_fname, 
		p->LLL_c0, p->LLL_beta, p->LLL_p, p->lambda, 
		FALSE /* f_restart */, 0 /* nb_restart */);
}

/*
** X-Designer Stub cb_LLL_restart
*/

void cb_LLL_restart(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	XmPushButtonCallbackStruct *call_data = (XmPushButtonCallbackStruct *) xt_call_data ;
	DISCRETA_FORM_DATA *p = form_data;
	
	get_form_data(p);
	cb_do_LLL(p->silence_level /* f_silent */, p->KM_fname, 
		p->LLL_c0, p->LLL_beta, p->LLL_p, p->lambda, 
		TRUE /* f_restart */, p->nb_restart);
}

/*
** X-Designer Stub cb_mckay
*/

void cb_mckay(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	// XmPushButtonCallbackStruct *call_data = (XmPushButtonCallbackStruct *) xt_call_data ;
	DISCRETA_FORM_DATA *p = form_data;
	
	get_form_data(p);
	do_mckay(p->KM_fname, p->lambda);
}

/*
** X-Designer Stub cb_spread
*/

void cb_spread(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	// XmPushButtonCallbackStruct *call_data = (XmPushButtonCallbackStruct *) xt_call_data ;
	DISCRETA_FORM_DATA *p = form_data;
	
	get_form_data(p);
	do_spread(p->silence_level /* f_silent */, p->KM_fname, p->lambda);
}

/*
** X-Designer Stub cb_dance
*/

void cb_dance(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	XmPushButtonCallbackStruct *call_data = (XmPushButtonCallbackStruct *) xt_call_data ;
	DISCRETA_FORM_DATA *p = form_data;
	
	get_form_data(p);
	do_dance(p->silence_level /* f_silent */, p->KM_fname, p->lambda);
}

/*
** X-Designer Stub cb_ls1
*/

void cb_ls1(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	// XmPushButtonCallbackStruct *call_data = (XmPushButtonCallbackStruct *) xt_call_data ;
	DISCRETA_FORM_DATA *p = form_data;
	
	get_form_data(p);
	do_largeset1(p->KM_fname, 
		p->LLL_c0, p->LLL_beta, p->LLL_p, p->largeset_N);
}

/*
** X-Designer Stub cb_ls2
*/

void cb_ls2(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	// XmPushButtonCallbackStruct *call_data = (XmPushButtonCallbackStruct *) xt_call_data ;
	DISCRETA_FORM_DATA *p = form_data;
	
	get_form_data(p);
	do_largeset2(p->KM_fname, 
		p->LLL_c0, p->LLL_beta, p->LLL_p, p->largeset_max_rounds, 
		p->largeset_N, p->largeset_max_solutions, p->largeset_max_loops);
}

/*
** X-Designer Stub cb_parameter
*/

void cb_parameter(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	XmPushButtonCallbackStruct *call_data = (XmPushButtonCallbackStruct *) xt_call_data ;

	XtManageChild(LLL_form_outer);
}

/*
** X-Designer Stub cb_get_solutions
*/

void cb_get_solutions(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	// XmPushButtonCallbackStruct *call_data = (XmPushButtonCallbackStruct *) xt_call_data ;
	DISCRETA_FORM_DATA *p = form_data;
	
	get_form_data(p);
	get_solutions(p->KM_fname, p->lambda);
}

/*
** X-Designer Stub cb_check_solutions
*/

void cb_check_solutions(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	// XmPushButtonCallbackStruct *call_data = (XmPushButtonCallbackStruct *) xt_call_data ;
	DISCRETA_FORM_DATA *p = form_data;
	
	get_form_data(p);
	check_solutions(p->KM_fname, p->lambda);
}



/*
 * report menu:
 */



/*
** X-Designer Stub cb_report
*/

void cb_report(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	// XmPushButtonCallbackStruct *call_data = (XmPushButtonCallbackStruct *) xt_call_data ;
	DISCRETA_FORM_DATA *p = form_data;

	get_form_data(p);
	do_report(p->KM_fname, TRUE /* f_html */, FALSE /* f_selected */, 0, 0, 0);
}
	

/*
** X-Designer Stub cb_report_selected
*/

void cb_report_selected(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	// XmPushButtonCallbackStruct *call_data = (XmPushButtonCallbackStruct *) xt_call_data ;
	DISCRETA_FORM_DATA *p = form_data;

	get_form_data(p);
	do_report(p->KM_fname, TRUE /* f_html */, TRUE /* f_selected */, 
		p->report_select_lambda, 
		p->report_select_first, 
		p->report_select_len);
}

/*
** X-Designer Stub cb_iso_test_canonical
*/

void cb_iso_test_canonical(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	XmPushButtonCallbackStruct *call_data = (XmPushButtonCallbackStruct *) xt_call_data ;
}

/*
** X-Designer Stub cb_iso_test_sylow
*/

void cb_iso_test_sylow(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	XmPushButtonCallbackStruct *call_data = (XmPushButtonCallbackStruct *) xt_call_data ;
}

/*
** X-Designer Stub cb_database
*/

void cb_database(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	// XmPushButtonCallbackStruct *call_data = (XmPushButtonCallbackStruct *) xt_call_data ;
	// DISCRETA_FORM_DATA *p = form_data;
	
	XtManageChild(Database_form_outer);
}



/*
** X-Designer Stub cb_show_design
*/

void cb_show_design(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	// XmPushButtonCallbackStruct *call_data = (XmPushButtonCallbackStruct *) xt_call_data ;
	DISCRETA_FORM_DATA *p = form_data;
	INT lambda, m;
	BYTE buf[10000];
	BYTE cmd[10000];
	
	
	get_form_data(p);
	lambda = p->lambda;
	m = p->p;
	if (solid_fname_available()) {
		read_solid_fname(buf);
		printf("displaying design using solid %s\n", buf);
		
		{
		MATRIX_OB M;
		VECTOR_OB G_gen, RR, MM, stab_go, Orbits_below1, Orbits_below2, S;
		INT v, t, k, i, j;
		VECTOR_OP Ok, Oki, ps;
		
		km_read_ascii(p->KM_fname, &M, &v, &t, &k, 
			&G_gen, &RR, &MM, &stab_go, &Orbits_below1, &Orbits_below2);
		km_get_solutions(p->KM_fname, lambda, 
			m - 1 /* from */, 1 /* len */, &S);
		printf("displaying solution %ld:\n", m);
		ps = (VECTOR_OP) S.s_i(0);
		for (i = 0; i < ps->s_li(); i++) {
			printf("%ld, ", ps->s_ii(i));
			}
		printf("\n");
		ps->println();
		Ok = (VECTOR_OP) RR.s_i(k);
		if (Ok->s_li() != ps->s_li())
			printf("warning: %ld = Ok->s_li() != ps->s_li() = %ld\n", 
				Ok->s_li(), ps->s_li());
		for (i = 0; i < ps->s_li(); i++) {
			if (ps->s_ii(i) == 0)
				continue;
			Oki = (VECTOR_OP) Ok->s_i(i);
			if (Oki->s_li() != k)
				printf("warning: %ld = Oki->s_li() != k = %ld\n", 
					Oki->s_li(), k);
			sprintf(cmd, "view3d --balls --select %ld ", k);
			for (j = 0; j < k; j++) {
				sprintf(cmd + strlen(cmd), "%ld ", 
					Oki->s_ii(j) - 1);
				}
			sprintf(cmd + strlen(cmd), "%s & ", buf);
			printf("%s\n", cmd); fflush(stdout);
			call_system(cmd);
			}
		}
		}
}



/*
** X-Designer Stub cb_show_memory_usage
*/

void cb_show_memory_usage(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	// XmPushButtonCallbackStruct *call_data = (XmPushButtonCallbackStruct *) xt_call_data ;
	DISCRETA_FORM_DATA *p = form_data;
	
	get_form_data(p);
	memory_usage();
}







/*
 * LLL dial:
 */

/*
** X-Designer Stub cb_LLL_ok
*/

void cb_LLL_ok(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	// XmPushButtonCallbackStruct *call_data = (XmPushButtonCallbackStruct *) xt_call_data ;
	// DISCRETA_FORM_DATA *p = form_data;
	
	XtUnmanageChild(LLL_form_outer);
}

/*
** X-Designer Stub cb_LLL_cncl
*/

void cb_LLL_cncl(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	// XmPushButtonCallbackStruct *call_data = (XmPushButtonCallbackStruct *) xt_call_data ;
	// DISCRETA_FORM_DATA *p = form_data;
	
	XtUnmanageChild(LLL_form_outer);
}






/* 
 * gsel  (=group selection) dialogue:
 */

/*
** X-Designer Stub cb_gsel_well_known
*/

void cb_gsel_well_known(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	// XmPushButtonCallbackStruct *call_data = (XmPushButtonCallbackStruct *) xt_call_data ;
	// DISCRETA_FORM_DATA *p = form_data;
	
	XtManageChild(OTHER_form_outer);
}

/*
** X-Designer Stub cb_gsel_linear
*/

void cb_gsel_linear(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	// XmPushButtonCallbackStruct *call_data = (XmPushButtonCallbackStruct *) xt_call_data ;
	// DISCRETA_FORM_DATA *p = form_data;
	
	XtManageChild(LIN_form_outer);
}

/*
** X-Designer Stub cb_gsel_sporadic
*/

void cb_gsel_sporadic(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	// XmPushButtonCallbackStruct *call_data = (XmPushButtonCallbackStruct *) xt_call_data ;
	// DISCRETA_FORM_DATA *p = form_data;
	
	XtManageChild(Sporadic_form_outer);
}

/*
** X-Designer Stub cb_gsel_solvable
*/

void cb_gsel_solvable(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	// XmPushButtonCallbackStruct *call_data = (XmPushButtonCallbackStruct *) xt_call_data ;
	// DISCRETA_FORM_DATA *p = form_data;
	
	XtManageChild(Solvable_form_outer);
}

/*
** X-Designer Stub cb_archimed
*/

void cb_archimed(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	// XmPushButtonCallbackStruct *call_data = (XmPushButtonCallbackStruct *) xt_call_data ;
	
	XtManageChild(Archimed_form_outer);
}


/*
** X-Designer Stub cb_gsel_file
*/

void cb_gsel_file(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	// XmPushButtonCallbackStruct *call_data = (XmPushButtonCallbackStruct *) xt_call_data ;
	DISCRETA_FORM_DATA *p = form_data;
	INT type, val1 = 0, val2 = 0;
	BYTE *q;
	
	get_form_data(p);
	type = FGA_GROUP_FROM_FILE;
	q = p->gsel_file;
	group_selection_add(p, type, val1, val2, q);
}

/*
** X-Designer Stub cb_gsel_file_select
*/

void cb_gsel_file_select(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	// XmPushButtonCallbackStruct *call_data = (XmPushButtonCallbackStruct *) xt_call_data ;
	// DISCRETA_FORM_DATA *p = form_data;
}

/*
** X-Designer Stub cb_gsel_generator
*/

void cb_gsel_generator(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	// XmPushButtonCallbackStruct *call_data = (XmPushButtonCallbackStruct *) xt_call_data ;
	DISCRETA_FORM_DATA *p = form_data;
	INT type, val1 = 0, val2 = 0;
	BYTE *q;
	
	get_form_data(p);
	type = FGA_GROUP_BY_PERMUTATION_GENERATOR;
	q = p->gsel_generator;
	group_selection_add(p, type, val1, val2, q);
}



/*
** X-Designer Stub cb_gsel_delete_item
*/

void cb_gsel_delete_item(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	// XmPushButtonCallbackStruct *call_data = (XmPushButtonCallbackStruct *) xt_call_data ;
	DISCRETA_FORM_DATA *p = form_data;
	
	group_selection_delete(p);
}

/*
** X-Designer Stub cb_gsel_clear_all
*/

void cb_gsel_clear_all(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	// XmPushButtonCallbackStruct *call_data = (XmPushButtonCallbackStruct *) xt_call_data ;
	DISCRETA_FORM_DATA *p = form_data;
	
	group_selection_clear(p);
}

/*
** X-Designer Stub cb_gsel_comma
*/

void cb_gsel_comma(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	// XmPushButtonCallbackStruct *call_data = (XmPushButtonCallbackStruct *) xt_call_data ;
	DISCRETA_FORM_DATA *p = form_data;
	
	group_selection_add(p, FGA_COMMA, 0, 0, NIL);
}

/*
** X-Designer Stub cb_gsel_dir_sum
*/

void cb_gsel_dir_sum(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	// XmPushButtonCallbackStruct *call_data = (XmPushButtonCallbackStruct *) xt_call_data ;
	DISCRETA_FORM_DATA *p = form_data;
	
	group_selection_add(p, FGA_DIRECT_SUM, 0, 0, NIL);
}

/*
** X-Designer Stub cb_gsel_dir_product
*/

void cb_gsel_dir_product(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	// XmPushButtonCallbackStruct *call_data = (XmPushButtonCallbackStruct *) xt_call_data ;
	DISCRETA_FORM_DATA *p = form_data;
	
	group_selection_add(p, FGA_DIRECT_PRODUCT, 0, 0, NIL);
}

/*
** X-Designer Stub cb_gsel_2sets
*/

void cb_gsel_2sets(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	// XmPushButtonCallbackStruct *call_data = (XmPushButtonCallbackStruct *) xt_call_data ;
	DISCRETA_FORM_DATA *p = form_data;
	
	group_selection_add(p, FGA_INDUCE_2_SETS, 0, 0, NIL);
}

/*
** X-Designer Stub cb_gsel_2tuples
*/

void cb_gsel_2tuples(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	// XmPushButtonCallbackStruct *call_data = (XmPushButtonCallbackStruct *) xt_call_data ;
	DISCRETA_FORM_DATA *p = form_data;
	
	group_selection_add(p, FGA_INDUCE_2_TUPLES, 0, 0, NIL);
}

/*
** X-Designer Stub cb_gsel_inj2tuples
*/

void cb_gsel_inj2tuples(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	// XmPushButtonCallbackStruct *call_data = (XmPushButtonCallbackStruct *) xt_call_data ;
	DISCRETA_FORM_DATA *p = form_data;
	
	group_selection_add(p, FGA_INDUCE_INJECTIVE_2_TUPLES, 0, 0, NIL);
}

/*
** X-Designer Stub cb_gsel_3sets
*/

void cb_gsel_3sets(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	// XmPushButtonCallbackStruct *call_data = (XmPushButtonCallbackStruct *) xt_call_data ;
	DISCRETA_FORM_DATA *p = form_data;
	
	group_selection_add(p, FGA_INDUCE_3_SETS, 0, 0, NIL);
}

/*
** X-Designer Stub cb_gsel_fixpoint
*/

void cb_gsel_fixpoint(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	// XmPushButtonCallbackStruct *call_data = (XmPushButtonCallbackStruct *) xt_call_data ;
	DISCRETA_FORM_DATA *p = form_data;
	
	group_selection_add(p, FGA_ADD_FIXPOINT, 0, 0, NIL);
}

/*
** X-Designer Stub cb_gsel_stabilize
*/

void cb_gsel_stabilize(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	// XmPushButtonCallbackStruct *call_data = (XmPushButtonCallbackStruct *) xt_call_data ;
	DISCRETA_FORM_DATA *p = form_data;
	
	group_selection_add(p, FGA_STABILIZE_POINT, 0, 0, NIL);
}

/*
** X-Designer Stub cb_gsel_wreath
*/

void cb_gsel_wreath(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	// XmPushButtonCallbackStruct *call_data = (XmPushButtonCallbackStruct *) xt_call_data ;
	DISCRETA_FORM_DATA *p = form_data;
	
	group_selection_add(p, FGA_WREATH_PRODUCT, 0, 0, NIL);
}

/*
** X-Designer Stub cb_gsel_expo
*/

void cb_gsel_expo(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	// XmPushButtonCallbackStruct *call_data = (XmPushButtonCallbackStruct *) xt_call_data ;
	DISCRETA_FORM_DATA *p = form_data;
	
	group_selection_add(p, FGA_EXPONENTIATION, 0, 0, NIL);
}

/*
** X-Designer Stub cb_gsel_mappings
*/

void cb_gsel_mappings(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	// XmPushButtonCallbackStruct *call_data = (XmPushButtonCallbackStruct *) xt_call_data ;
	DISCRETA_FORM_DATA *p = form_data;
	
	group_selection_add(p, FGA_ON_MAPPINGS, 0, 0, NIL);
	// group_selection_add(p, FGA_HOLOMORPH, 0, 0, NIL);
}

/*
** X-Designer Stub cb_gsel_select_i_th
*/

void cb_gsel_select_i_th(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	// XmPushButtonCallbackStruct *call_data = (XmPushButtonCallbackStruct *) xt_call_data ;
	DISCRETA_FORM_DATA *p = form_data;
	INT val1, val2 = 0;
	
	get_form_data(p);
	val1 = p->i_th;
	group_selection_add(p, FGA_SELECT_ITH, val1, val2, NIL);
}

/*
** X-Designer Stub cb_gsel_ith
*/

void cb_gsel_ith(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	// XmPushButtonCallbackStruct *call_data = (XmPushButtonCallbackStruct *) xt_call_data ;
	DISCRETA_FORM_DATA *p = form_data;
	INT val1, val2 = 0;

	get_form_data(p);
	val1 = p->i_th;
	group_selection_add(p, FGA_POWER, val1, val2, NIL);
}

/*
** X-Designer Stub cb_gsel_choose
*/

void cb_gsel_choose(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	// XmAnyCallbackStruct *call_data = (XmAnyCallbackStruct *) xt_call_data;
	DISCRETA_FORM_DATA *p = form_data;
	VECTOR_OB gen;
	BYTE g_label[10000];
	BYTE g_label_tex[10000];
	
	get_group_from_selection(p->g_sel, p->g_nb_items, 
		&gen, g_label, g_label_tex);
	// XtUnmanageChild(Gsel_form_outer);
}

/*
** X-Designer Stub cb_gsel_dismiss
*/

void cb_gsel_dismiss(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	// XmPushButtonCallbackStruct *call_data = (XmPushButtonCallbackStruct *) xt_call_data ;
	// DISCRETA_FORM_DATA *p = form_data;
	
	XtUnmanageChild(Gsel_form_outer);
}




#include "dial_g.C"





/* 
 * OTHER (=well known) dial:
 */




/*
** X-Designer Stub cb_other_choose
*/

void cb_other_choose(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	// XmPushButtonCallbackStruct *call_data = (XmPushButtonCallbackStruct *) xt_call_data ;
	// DISCRETA_FORM_DATA *p = form_data;
	
	choose_well_known_group();
	// XtUnmanageChild(OTHER_form_outer);
}

/*
** X-Designer Stub cb_other_dismiss
*/

void cb_other_dismiss(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	// XmPushButtonCallbackStruct *call_data = (XmPushButtonCallbackStruct *) xt_call_data ;
	// DISCRETA_FORM_DATA *p = form_data;
	
	XtUnmanageChild(OTHER_form_outer);
}

/*
** X-Designer Stub cb_toggle_well_known
*/

void cb_toggle_well_known(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	// XmToggleButtonCallbackStruct *call_data = (XmToggleButtonCallbackStruct *) xt_call_data ;
	DISCRETA_FORM_DATA *p = form_data;
	Arg args[64];
	INT n, j = (INT) client_data;
	Widget w1, w2;
	
	w1 = widget_well_known(p->well_rb_state);
	n = 0;
	XtSetArg(args[n], XmNset, FALSE); n++;
	XtSetValues(w1, args, n);

	p->well_rb_state = j;
	w2 = widget_well_known(p->well_rb_state);

	n = 0;
	XtSetArg(args[n], XmNset, TRUE); n++;
	XtSetValues(w2, args, n);
}


#include "dial_well.C"




/*
 * linear dial:
 */

/*
** X-Designer Stub cb_linear_choose
*/

void cb_linear_choose(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	// XmPushButtonCallbackStruct *call_data = (XmPushButtonCallbackStruct *) xt_call_data ;
	// DISCRETA_FORM_DATA *p = form_data;
	
	choose_linear_group();
}

/*
** X-Designer Stub cb_linear_dismiss
*/

void cb_linear_dismiss(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	// XmPushButtonCallbackStruct *call_data = (XmPushButtonCallbackStruct *) xt_call_data ;
	// DISCRETA_FORM_DATA *p = form_data;
	
	XtUnmanageChild(LIN_form_outer);
}


/*
** X-Designer Stub cb_linear_toggle
*/

void cb_linear_toggle(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	// XmToggleButtonCallbackStruct *call_data = (XmToggleButtonCallbackStruct *) xt_call_data ;
	DISCRETA_FORM_DATA *p = form_data;
	Arg args[64];
	INT n, j = (INT) client_data;
	Widget w1, w2;
	
	w1 = widget_linear(p->linear_toggle);
	n = 0;
	XtSetArg(args[n], XmNset, FALSE); n++;
	XtSetValues(w1, args, n);

	p->linear_toggle = j;
	w2 = widget_linear(j);

	n = 0;
	XtSetArg(args[n], XmNset, TRUE); n++;
	XtSetValues(w2, args, n);
}

#include "dial_linear.C"



/*
 * sporadic dial:
 */

/*
** X-Designer Stub cb_sporadic_choose
*/

void cb_sporadic_choose(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	// XmPushButtonCallbackStruct *call_data = (XmPushButtonCallbackStruct *) xt_call_data ;
	// DISCRETA_FORM_DATA *p = form_data;
	
	choose_sporadic_group();
}

/*
** X-Designer Stub cb_sporadic_dismiss
*/

void cb_sporadic_dismiss(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	// XmPushButtonCallbackStruct *call_data = (XmPushButtonCallbackStruct *) xt_call_data ;
	// DISCRETA_FORM_DATA *p = form_data;
	
	XtUnmanageChild(Sporadic_form_outer);
}

/*
** X-Designer Stub cb_sporadic_toggle
*/

void cb_sporadic_toggle(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	// XmToggleButtonCallbackStruct *call_data = (XmToggleButtonCallbackStruct *) xt_call_data ;
	DISCRETA_FORM_DATA *p = form_data;
	Arg args[64];
	INT n, j = (INT) client_data;
	Widget w1, w2;
	
	w1 = widget_sporadic(p->sporadic_toggle);
	n = 0;
	XtSetArg(args[n], XmNset, FALSE); n++;
	XtSetValues(w1, args, n);

	p->sporadic_toggle = j;
	w2 = widget_sporadic(j);

	n = 0;
	XtSetArg(args[n], XmNset, TRUE); n++;
	XtSetValues(w2, args, n);
}

#include "dial_sporadic.C"



/*
 * solvable-dialogue:
 */

/*
** X-Designer Stub cb_solvable_choose
*/

void cb_solvable_choose(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	// XmPushButtonCallbackStruct *call_data = (XmPushButtonCallbackStruct *) xt_call_data ;
	// DISCRETA_FORM_DATA *p = form_data;
	
	choose_solvable_group();
}

/*
** X-Designer Stub cb_solvable_dismiss
*/

void cb_solvable_dismiss(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	// XmPushButtonCallbackStruct *call_data = (XmPushButtonCallbackStruct *) xt_call_data ;
	// DISCRETA_FORM_DATA *p = form_data;
	
	XtUnmanageChild(Solvable_form_outer);
}

/*
** X-Designer Stub cb_solvable_toggle
*/

void cb_solvable_toggle(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	// XmToggleButtonCallbackStruct *call_data = (XmToggleButtonCallbackStruct *) xt_call_data ;
	DISCRETA_FORM_DATA *p = form_data;
	Arg args[64];
	INT n, j = (INT) client_data;
	Widget w1, w2;
	
	w1 = widget_solvable(p->solvable_toggle);
	n = 0;
	XtSetArg(args[n], XmNset, FALSE); n++;
	XtSetValues(w1, args, n);

	p->solvable_toggle = j;
	w2 = widget_solvable(j);

	n = 0;
	XtSetArg(args[n], XmNset, TRUE); n++;
	XtSetValues(w2, args, n);
}



#include "dial_solvable.C"










/*
 * solid-dialogue
 */

/*
** X-Designer Stub cb_archimed_choose
*/

void cb_archimed_choose(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	// XmPushButtonCallbackStruct *call_data = (XmPushButtonCallbackStruct *) xt_call_data ;

	choose_regular_solid();
}

/*
** X-Designer Stub cb_archimed_dismiss
*/

void cb_archimed_dismiss(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	// XmPushButtonCallbackStruct *call_data = (XmPushButtonCallbackStruct *) xt_call_data ;

	XtUnmanageChild(Archimed_form_outer);
}

/*
** X-Designer Stub cb_solid_toggle
*/

void cb_solid_toggle(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	// XmToggleButtonCallbackStruct *call_data = (XmToggleButtonCallbackStruct *) xt_call_data ;
	DISCRETA_FORM_DATA *p = form_data;
	Arg args[64];
	INT n, j = (INT) client_data;
	Widget w1, w2;
	
	w1 = widget_solid(p->solid_toggle);
	n = 0;
	XtSetArg(args[n], XmNset, FALSE); n++;
	XtSetValues(w1, args, n);

	p->solid_toggle = j;
	w2 = widget_solid(j);

	n = 0;
	XtSetArg(args[n], XmNset, TRUE); n++;
	XtSetValues(w2, args, n);
}

#include "dial_solid.C"












/* 
 * database dialogue
 */


/*
** X-Designer Stub cb_db_create
*/

void cb_db_create(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	// XmPushButtonCallbackStruct *call_data = (XmPushButtonCallbackStruct *) xt_call_data ;
	// DISCRETA_FORM_DATA *p = form_data;
	BYTE *fname = "despar";
	
	do_db_dp_create_and_close(DP_PATH);
	despar_db_create(fname);
}

/*
** X-Designer Stub cb_db_add
*/

void cb_db_add(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	// XmPushButtonCallbackStruct *call_data = (XmPushButtonCallbackStruct *) xt_call_data ;
	DISCRETA_FORM_DATA *p = form_data;
	DATABASE_OP db;
	MATRIX_OB data;
	INT t, v, k, lambda;
	FILE *fp_tex;
	BYTE *comment = NIL;
	INT f_v = FALSE;
	
	get_form_data(p);
	db_add(p->t, p->v, p->k, p->lambda);
	t = p->t;
	v = p->v;
	k = p->k;
	lambda = p->lambda;
	
	i_db_dp(&db, DP_PATH);
	
	printf("t = %ld v = %ld k = %ld lambda = %ld\n", t, v, k, lambda);
	fflush(stdout);
	if (t == 0 || v == 0 || k == 0 || lambda == 0)
		return;
		
	// fp_tex = fopen("parameter_sets.tex", "w");
	fp_tex = stdout;
	fprintf(fp_tex, "\\noindent\n{\\bf Parameter sets obtained from %ld-(%ld,%ld,%ld)}\n", 
		t, v, k, lambda);
	fprintf(fp_tex, "\\[\n\\begin{array}{rll}\n");
	db_dp_design_parameter_produce(db, t, v, k, lambda, comment, f_v, fp_tex, &data);
	fprintf(fp_tex, "\\end{array}\n\\]\n");
	// fclose(fp_tex);
	
	e_db_dp(db);
	
}

/*
** X-Designer Stub cb_db_read_base
*/

void cb_db_read_base(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	// XmPushButtonCallbackStruct *call_data = (XmPushButtonCallbackStruct *) xt_call_data ;
	// DISCRETA_FORM_DATA *p = form_data;
	VECTOR_OB vec_data;
	
	db_dp_read_design_txt("design.txt", "design.tex", DP_PATH, 
		FALSE /* f_clear_always */, &vec_data);
	db_add_vec_data(&vec_data);
}

/*
** X-Designer Stub cb_db_read_base_clear_always
*/

void cb_db_read_base_clear_always(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	// XmPushButtonCallbackStruct *call_data = (XmPushButtonCallbackStruct *) xt_call_data ;
	// DISCRETA_FORM_DATA *p = form_data;
	VECTOR_OB vec_data;
	
	db_dp_read_design_txt("design.txt", "design.tex", DP_PATH, 
		TRUE /* f_clear_always */, &vec_data);
	db_add_vec_data(&vec_data);
}

/*
** X-Designer Stub cb_db_write_html
*/

void cb_db_write_html(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	// XmPushButtonCallbackStruct *call_data = (XmPushButtonCallbackStruct *) xt_call_data ;
	// DISCRETA_FORM_DATA *p = form_data;
	
	db_dp_HTML(DP_PATH);
}

/*
** X-Designer Stub cb_db_dump
*/

void cb_db_dump(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	// XmPushButtonCallbackStruct *call_data = (XmPushButtonCallbackStruct *) xt_call_data ;
	// DISCRETA_FORM_DATA *p = form_data;
}

/*
** X-Designer Stub cb_search
*/

void cb_search(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	// XmPushButtonCallbackStruct *call_data = (XmPushButtonCallbackStruct *) xt_call_data ;
	DISCRETA_FORM_DATA *p = form_data;
	INT t_min, t_max;
	INT v_min, v_max;
	INT k_min, k_max;
	INT lambda_min, lambda_max;
	DATABASE_OP db;
	BAYERTREE_OP btree;
	DESIGN_PARAMETER_OB dp_obj;
	KEYTYPE key;
	DATATYPE data;
	INT4 *pi;
	INT btree_idx, idx, idx0, idx1, f_found, i, l, no, t, v, k, lambda, id;
	BYTE str[10000];
	
	get_form_data(p);
	t_min = p->t_min;
	t_max = p->t_max;
	v_min = p->v_min;
	v_max = p->v_max;
	k_min = p->k_min;
	k_max = p->k_max;
	lambda_min = p->lambda_min;
	lambda_max = p->lambda_max;
	printf("%ld <= t <= %ld\n", t_min, t_max);
	printf("%ld <= v <= %ld\n", v_min, v_max);
	printf("%ld <= k <= %ld\n", k_min, k_max);
	printf("%ld <= \\lambda <= %ld\n", lambda_min, lambda_max);
	despar_search(t_min, t_max, v_min, v_max, k_min, k_max, lambda_min, lambda_max);
#if 0
	i_db_dp(&db, DP_PATH);
	
	btree_idx = 2; /* t, v, k, lambda, id */
	btree = db->s_btree_i(btree_idx);
	if (db->open() != OK) {
		error("cb_search() DB::open");
		return;
		}
	if (btree->len(&l) != OK) {
		error("cb_search() BT::len");
		return;
		}
	pi = (INT4 *) &key;
	pi[0] = t_min;
	pi[1] = 0;
	pi[2] = 0;
	pi[3] = 0;
	pi[4] = 0; /* id */
	if (btree->search(pi /* pSearchKey */, 
		&data, &idx, &f_found) != OK) {
		error("cb_search() BT::search");
		return;
		}
	idx0 = idx - 1;
	printf("idx0=%ld\n", idx0);
	pi[0] = t_max + 1;
	if (btree->search(pi /* pSearchKey */, 
		&data, &idx, &f_found) != OK) {
		error("cb_search() BT::search");
		return;
		}
	idx1 = idx;
	printf("idx1=%ld\n", idx1);
	
	no = 0;
	for (i = idx0; i <= idx1; i++) {
		if (i < 0)
			continue;
		if (i >= l)
			continue;
		if (btree->ith(i, &key, &data) != OK) {
			error("cb_search() BT::ith");
			return;
			}
		if (db->get_op(&data, &dp_obj) != OK) {
			error("cb_search() DB::get_op");
			return;
			}
		t = dp_obj.s_t_i();
		v = dp_obj.s_v_i();
		k = dp_obj.s_k_i();
		lambda = dp_obj.s_lambda_i();
		id = dp_obj.s_id_i();
		printf("idx=%ld: t=%ld v=%ld k=%ld lambda=%ld id=%ld\n", 
			i, t, v, k, lambda, id);
		
		if (t < t_min)
			continue;
		if (v < v_min)
			continue;
		if (k < k_min)
			continue;
		if (lambda < lambda_min)
			continue;
		if (t > t_max)
			continue;
		if (v_max && v > v_max)
			continue;
		if (k_max && k > k_max)
			continue;
		if (lambda_max && lambda > lambda_max)
			continue;

		no++;
		str[0] = 0;
		dp_obj.sprint(str);
		printf("%ld: %s (id=%ld)\n", no, str, id);
		
		}
	printf("found %ld datasets\n", no);
	if (db->close() != OK) {
		error("cb_search() DB::close");
		return;
		}
#endif
}

/*
** X-Designer Stub cb_delete
*/

void cb_delete(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	// delete in the database
	// XmPushButtonCallbackStruct *call_data = (XmPushButtonCallbackStruct *) xt_call_data ;
	DISCRETA_FORM_DATA *p = form_data;
	INT t_min, t_max;
	INT v_min, v_max;
	INT k_min, k_max;
	INT lambda_min, lambda_max;
	
	get_form_data(p);
	t_min = p->t_min;
	t_max = p->t_max;
	v_min = p->v_min;
	v_max = p->v_max;
	k_min = p->k_min;
	k_max = p->k_max;
	lambda_min = p->lambda_min;
	lambda_max = p->lambda_max;
	printf("%ld <= t <= %ld\n", t_min, t_max);
	printf("%ld <= v <= %ld\n", v_min, v_max);
	printf("%ld <= k <= %ld\n", k_min, k_max);
	printf("%ld <= \\lambda <= %ld\n", lambda_min, lambda_max);
	// despar_delete(t_min, t_max, v_min, v_max, k_min, k_max, lambda_min, lambda_max);
}

/*
** X-Designer Stub cb_dismiss
*/

void cb_dismiss(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	// XmPushButtonCallbackStruct *call_data = (XmPushButtonCallbackStruct *) xt_call_data ;
	// DISCRETA_FORM_DATA *p = form_data;
	
	XtUnmanageChild(Database_form_outer);
}


#include "cb.C"
#include "db.C"
#include "tvt.C"

/*
** X-Designer Stub cb_tvt_closure
*/

void cb_tvt_closure(Widget w, XtPointer client_data, XtPointer xt_call_data)
{
	// XmPushButtonCallbackStruct *call_data = (XmPushButtonCallbackStruct *) xt_call_data ;
	
	db_dp_tvt_closure();
}


